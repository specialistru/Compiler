# Compiler

## Этап 1: Архитектура и базовые модули

### 1.1. Модуль лексера (lexer)

* Поддержка полного набора лексем ABAP (ключевые слова, идентификаторы, литералы, операторы)
* Поддержка многострочных комментариев, строк, спецсимволов
* Учёт юникода и локализации (UTF-8)

### 1.2. Модуль парсера (parser)

* Рекурсивный нисходящий парсер или парсер на основе грамматики (LL(1) или LALR)
* Поддержка всего синтаксиса ABAP:

  * Операторы: IF, CASE, LOOP, WHILE, DO, PERFORM, FUNCTION CALL
  * Определения: DATA, TYPES, CONSTANTS, CLASS, INTERFACE
  * Управление блоками (BEGIN, END)
* Полный AST с узлами для каждого типа конструкции

### 1.3. Семантический анализ (semantic)

* Система областей видимости (глобальная, локальная, блоки)
* Таблица символов с типами, проверка объявлений и использований
* Проверка типов (статическая типизация), совместимость типов
* Проверка объявлений процедур, функций, методов
* Поддержка пользовательских типов (структуры, таблицы, классы)

---

## Этап 2: Промежуточное представление (IR) и генерация кода

### 2.1. Разработка IR

* Создание представления в виде байткода или трёхадресного кода
* Поддержка выражений, вызовов функций, условий, циклов
* Стек вызовов, управление локальными переменными и параметрами

### 2.2. Генератор IR

* Преобразование AST в IR
* Поддержка сложных конструкций (циклы, условия, вызовы)
* Обработка рекурсии

---

## Этап 3: Оптимизации

### 3.1. Простые оптимизации

* Устранение мёртвого кода
* Константное свёртывание
* Инлайнинг функций

### 3.2. Продвинутые оптимизации

* Алгебраические преобразования
* Оптимизация циклов (распараллеливание, разворачивание)
* Управление регистрами / памятью

---

## Этап 4: Интерпретатор и/или JIT-компилятор

### 4.1. Интерпретатор IR

* Исполнение байткода с поддержкой стековой машины
* Поддержка рекурсии, параметров функций, локальных переменных

### 4.2. JIT-компиляция (по желанию)

* Генерация машинного кода из IR для ускорения исполнения

---

## Этап 5: Среда выполнения ABAP

* Работа с базами данных через OpenSQL API
* Поддержка внутренних таблиц, классов, событий, модулей
* Управление ошибками, исключениями, транзакциями
* Поддержка параллелизма (блокировки, синхронизация)

---

## Этап 6: Инструменты и поддержка разработчиков

* Отладчик с точками останова, пошаговым выполнением
* Профилировщик
* Система логирования и трассировки
* Поддержка интеграции с SAP GUI / SAP Fiori (если нужно)

---

# Разбиение по модулям проекта

| Модуль               | Задачи и структуры данных                                                   |
| -------------------- | --------------------------------------------------------------------------- |
| lexer.c/h            | Лексемы, позиция, буфер, функции для разбора исходника                      |
| parser.c/h           | AST узлы, грамматика, синтаксический анализатор                             |
| semantic.c/h         | Семантический анализ: Таблицы символов, области видимости, типы, проверка   |
| ast.c/h              | Узлы AST, функции построения и обхода                                       |
| ir.c/h               | Структуры IR инструкций, управление списком инструкций                      |
| ir_generator.c/h     | Трансляция AST в IR (генерация IR и его хранение)                           |
| optimizer.c/h        | Алгоритмы оптимизации IR                                                    |
| interpreter.c/h      | Стек вызовов, регистры, исполнение инструкций интерпретатор IR              |
| parameters.c/h       | инфраструктура.                                                             |
| perform.c/h          | инфраструктура.                                                             |
| jit\_compiler (опц.) | Генерация машинного кода из IR                                              |
| runtime              | Реализация стандартной библиотеки ABAP, базы, таблицы, объекты              |
| error_handling.c/h   | Обработка ошибок, исключений                                                |
| tools/debugger       | Отладка, профилирование                                                     |
| tests/               | тестирование всех компонентов вместе.                                       |
| examples/            | демонстрация параметров и perform.                                          |
| Makefile             | сборка всего проекта.                                                       |
